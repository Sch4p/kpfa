"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[545],{4545:function(e,t,r){r.r(t),r.d(t,{default:function(){return D}});var s=r(6768),a=r(5130),o=r(4232);const l={class:"container py-5"},i={key:0,class:"text-center py-5"},n={key:1,class:"alert alert-warning"},d={key:2,class:"text-center py-5"},m={class:"row g-4"},c={class:"col-md-7"},u={class:"card p-4 shadow-sm border-0"},p={class:"mb-3"},h={key:0,class:"form-text text-danger"},f={class:"mb-3"},g={key:0,class:"form-text text-danger"},k={class:"mb-3"},v={key:0,class:"form-text text-danger"},b={class:"mb-3"},y={key:0,class:"form-text text-danger"},_={class:"mb-3"},L={key:0,class:"form-text text-danger"},x={key:0,class:"mt-3"},E={key:0,class:"text-danger small mt-1"},P={class:"mt-3"},C={class:"col-md-5"},w={class:"card p-4 shadow-sm border-0"},A={class:"list-group list-group-flush mb-3"},S={class:"d-flex align-items-center"},F=["src"],I={class:"d-block small"},N={class:"text-muted"},O={class:"d-flex justify-content-between fw-bold border-top pt-3"},X={key:0,class:"mt-3"},M=["disabled"],q={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},U={key:4,class:"alert alert-success mt-4"},$={key:5,class:"alert alert-danger mt-4"};function Q(e,t,r,Q,T,j){const B=(0,s.g2)("router-link");return(0,s.uX)(),(0,s.CE)("div",l,[t[28]||(t[28]=(0,s.Lk)("h2",{class:"fw-bold text-danger mb-4"},"Checkout",-1)),T.isLoadingAuth?((0,s.uX)(),(0,s.CE)("div",i,[...t[8]||(t[8]=[(0,s.Lk)("div",{class:"spinner-border text-danger",role:"status"},null,-1),(0,s.Lk)("p",{class:"mt-3 text-muted"},"Checking authentication...",-1)])])):j.isAuthenticated?T.cartItems.length?((0,s.uX)(),(0,s.CE)("form",{key:3,onSubmit:t[7]||(t[7]=(0,a.D$)((...e)=>j.submitOrder&&j.submitOrder(...e),["prevent"])),novalidate:""},[(0,s.Lk)("div",m,[(0,s.Lk)("div",c,[(0,s.Lk)("div",u,[t[24]||(t[24]=(0,s.Lk)("h5",{class:"fw-bold mb-3 text-secondary"},"Shipping Details",-1)),(0,s.Lk)("div",p,[t[14]||(t[14]=(0,s.Lk)("label",{class:"form-label"},"Full Name *",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>T.form.full_name=e),type:"text",class:"form-control",required:""},null,512),[[a.Jo,T.form.full_name,void 0,{trim:!0}]]),T.errors.full_name?((0,s.uX)(),(0,s.CE)("div",h,(0,o.v_)(T.errors.full_name),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",f,[t[15]||(t[15]=(0,s.Lk)("label",{class:"form-label"},"Phone Number *",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>T.form.phone=e),type:"tel",class:"form-control",placeholder:"+2348012345678",required:""},null,512),[[a.Jo,T.form.phone,void 0,{trim:!0}]]),T.errors.phone?((0,s.uX)(),(0,s.CE)("div",g,(0,o.v_)(T.errors.phone),1)):(0,s.Q3)("",!0),t[16]||(t[16]=(0,s.Lk)("small",{class:"text-muted"}," Accepts international formats (e.g. +234, +233, +229, +225, +227, +228). ",-1))]),(0,s.Lk)("div",k,[t[17]||(t[17]=(0,s.Lk)("label",{class:"form-label"},"Email *",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>T.form.email=e),type:"email",class:"form-control",required:""},null,512),[[a.Jo,T.form.email,void 0,{trim:!0}]]),T.errors.email?((0,s.uX)(),(0,s.CE)("div",v,(0,o.v_)(T.errors.email),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",b,[t[18]||(t[18]=(0,s.Lk)("label",{class:"form-label"},"Shipping Address *",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[3]||(t[3]=e=>T.form.shipping_address=e),class:"form-control",rows:"3",required:""},null,512),[[a.Jo,T.form.shipping_address,void 0,{trim:!0}]]),T.errors.shipping_address?((0,s.uX)(),(0,s.CE)("div",y,(0,o.v_)(T.errors.shipping_address),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",_,[t[20]||(t[20]=(0,s.Lk)("label",{class:"form-label fw-semibold"},"Payment Method *",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>T.form.payment_method=e),class:"form-select",required:""},[...t[19]||(t[19]=[(0,s.Fv)('<option value="" data-v-43318f5a>Select Payment Method</option><option value="BANK_TRANSFER" data-v-43318f5a>Bank Transfer / Opay</option><option value="MONIEPOINT" disabled data-v-43318f5a>Moniepoint</option><option value="MOMOGH" disabled data-v-43318f5a>MTN Mobile Money Ghana</option><option value="COD" data-v-43318f5a>Cash on Delivery</option>',5)])],512),[[a.u1,T.form.payment_method]]),T.errors.payment_method?((0,s.uX)(),(0,s.CE)("div",L,(0,o.v_)(T.errors.payment_method),1)):(0,s.Q3)("",!0)]),"BANK_TRANSFER"===T.form.payment_method?((0,s.uX)(),(0,s.CE)("div",x,[t[21]||(t[21]=(0,s.Lk)("label",{class:"form-label fw-semibold"},"Upload Proof of Payment *",-1)),(0,s.Lk)("input",{ref:"fileInput",type:"file",onChange:t[5]||(t[5]=(...e)=>j.handleFileUpload&&j.handleFileUpload(...e)),class:"form-control",accept:".jpg,.jpeg,.png,.pdf"},null,544),t[22]||(t[22]=(0,s.Lk)("small",{class:"text-muted"}," Max size: 2MB. Allowed formats: JPG, PNG, PDF. ",-1)),T.fileError?((0,s.uX)(),(0,s.CE)("div",E,(0,o.v_)(T.fileError),1)):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),(0,s.Lk)("div",P,[t[23]||(t[23]=(0,s.Lk)("label",{class:"form-label"},"Notes (optional)",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[6]||(t[6]=e=>T.form.notes=e),class:"form-control",rows:"2"},null,512),[[a.Jo,T.form.notes,void 0,{trim:!0}]])])])]),(0,s.Lk)("div",C,[(0,s.Lk)("div",w,[t[27]||(t[27]=(0,s.Lk)("h5",{class:"fw-bold mb-3 text-secondary"},"Order Summary",-1)),(0,s.Lk)("ul",A,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(T.cartItems,e=>((0,s.uX)(),(0,s.CE)("li",{key:e.id,class:"list-group-item d-flex justify-content-between align-items-center"},[(0,s.Lk)("div",S,[e.image?((0,s.uX)(),(0,s.CE)("img",{key:0,src:j.imageUrl(e.image),alt:"",style:{width:"48px",height:"48px","object-fit":"cover","border-radius":"6px","margin-right":".75rem"}},null,8,F)):(0,s.Q3)("",!0),(0,s.Lk)("div",null,[(0,s.Lk)("strong",I,(0,o.v_)(e.name),1),(0,s.Lk)("small",N,"x"+(0,o.v_)(e.qty),1)])]),(0,s.Lk)("span",null,"‚Ç¶"+(0,o.v_)(j.formatPrice(e.price*e.qty)),1)]))),128))]),(0,s.Lk)("div",O,[t[25]||(t[25]=(0,s.Lk)("span",null,"Total:",-1)),(0,s.Lk)("span",null,"‚Ç¶"+(0,o.v_)(j.formatPrice(j.cartSubtotal)),1)]),"BANK_TRANSFER"===T.form.payment_method?((0,s.uX)(),(0,s.CE)("div",X,[...t[26]||(t[26]=[(0,s.Lk)("div",{class:"alert alert-info small"},[(0,s.eW)(" Please complete the transfer to our designated provider (Opay/Moniepoint/Bank). Upload the receipt above. "),(0,s.Lk)("div",{class:"mt-2"},[(0,s.Lk)("strong",null,"Note:"),(0,s.eW)(" Payment instructions will be sent to your email once the order is created. ")])],-1)])])):(0,s.Q3)("",!0),(0,s.Lk)("button",{type:"submit",class:"btn btn-danger w-100 mt-4",disabled:T.loading},[T.loading?((0,s.uX)(),(0,s.CE)("span",q)):(0,s.Q3)("",!0),(0,s.eW)(" "+(0,o.v_)(T.loading?"Processing...":"Place Order"),1)],8,M)])])])],32)):((0,s.uX)(),(0,s.CE)("div",d,[t[13]||(t[13]=(0,s.Lk)("p",{class:"lead text-muted"}," Your cart is empty. Please add items before checkout. ",-1)),(0,s.bF)(B,{to:"/eshop",class:"btn btn-danger"},{default:(0,s.k6)(()=>[...t[12]||(t[12]=[(0,s.eW)(" Back to Shop ",-1)])]),_:1})])):((0,s.uX)(),(0,s.CE)("div",n,[t[10]||(t[10]=(0,s.eW)(" Please ",-1)),(0,s.bF)(B,{to:{path:"/fan-auth",query:{redirect:e.$route.fullPath}},class:"ms-1 text-primary"},{default:(0,s.k6)(()=>[...t[9]||(t[9]=[(0,s.eW)(" log in ",-1)])]),_:1},8,["to"]),t[11]||(t[11]=(0,s.eW)(" to complete your purchase. ",-1))])),T.successMessage?((0,s.uX)(),(0,s.CE)("div",U,(0,o.v_)(T.successMessage),1)):(0,s.Q3)("",!0),T.submitError?((0,s.uX)(),(0,s.CE)("div",$,(0,o.v_)(T.submitError),1)):(0,s.Q3)("",!0)])}r(4114),r(8111),r(1701),r(8237);var T=r(4373),j={name:"Checkout",data(){return{isLoadingAuth:!0,token:null,cartItems:[],form:{full_name:"",phone:"",email:"",shipping_address:"",payment_method:"",notes:""},paymentProofFile:null,fileError:"",loading:!1,submitError:"",successMessage:"",errors:{}}},computed:{isAuthenticated(){return!!this.token},cartSubtotal(){return this.cartItems.reduce((e,t)=>e+Number(t.price||0)*Number(t.qty||0),0)}},methods:{checkAuthStatus(){this.token=localStorage.getItem("token")||null,this.token?T.A.defaults.headers.common["Authorization"]=`Token ${this.token}`:delete T.A.defaults.headers.common["Authorization"],this.isLoadingAuth=!1},loadCart(){try{const e=localStorage.getItem("kpfa_cart");this.cartItems=e?JSON.parse(e):[]}catch{this.cartItems=[]}},validateForm(){return this.errors={},this.form.full_name||(this.errors.full_name="Full name is required."),this.form.phone||(this.errors.phone="Phone is required."),this.form.email||(this.errors.email="Email is required."),this.form.shipping_address||(this.errors.shipping_address="Shipping address is required."),this.form.payment_method||(this.errors.payment_method="Please select a payment method."),"BANK_TRANSFER"!==this.form.payment_method||this.paymentProofFile||(this.errors.payment_proof="Payment proof required."),0===Object.keys(this.errors).length},handleFileUpload(e){this.fileError="";const t=e.target.files[0];if(!t)return;const r=["image/jpeg","image/jpg","image/png","application/pdf"];return r.includes(t.type)?t.size>2097152?(this.fileError="File too large. Max size 2 MB.",void(this.$refs.fileInput&&(this.$refs.fileInput.value=""))):void(this.paymentProofFile=t):(this.fileError="Invalid file type. Please upload JPG, PNG or PDF.",void(this.$refs.fileInput&&(this.$refs.fileInput.value="")))},imageUrl(e){return e?e.startsWith("http")?e:`${window.location.origin}/${e}`:""},formatPrice(e){return Number(e).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})},async submitOrder(){if(this.loading)return;const e=localStorage.getItem("token");if(!e)return alert("Please log in before placing an order."),void this.$router.push({name:"Login"});const t={full_name:this.form.full_name,phone:this.form.phone,email:this.form.email,shipping_address:this.form.shipping_address,payment_method:this.form.payment_method,notes:this.form.notes,order_items:this.cartItems.map(e=>({item:e.id,quantity:e.qty}))};try{this.loading=!0,console.log("üõ∞Ô∏è Order payload being sent:",t);const r=await T.A.post("http://127.0.0.1:8000/api/orders/",t,{headers:{Authorization:`Token ${e}`,"Content-Type":"application/json"}});console.log("‚úÖ Order response:",r.data),alert("üéâ Order placed successfully!"),this.cartItems=[],localStorage.removeItem("kpfa_cart"),this.successMessage="Your order has been placed successfully!",console.log("Redirecting to:",`/order-summary/${r.data.id}`),201===r.status&&this.$router.push({name:"OrderSummary",params:{id:r.data.id}})}catch(r){console.error("‚ùå Order error:",r.res?.data||r.message),401===r.res?.status?(alert("Your session has expired. Please log in again."),this.$router.push({name:"Login"})):alert("Failed to place order. Please try again.")}finally{this.loading=!1}}},mounted(){this.loadCart(),this.checkAuthStatus(),window.addEventListener("storage",this.checkAuthStatus)},beforeUnmount(){window.removeEventListener("storage",this.checkAuthStatus)}},B=r(1241);const R=(0,B.A)(j,[["render",Q],["__scopeId","data-v-43318f5a"]]);var D=R}}]);
//# sourceMappingURL=545.cecaca71.js.map