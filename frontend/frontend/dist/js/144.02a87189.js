"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[144],{4144:function(e,t,a){a.r(t),a.d(t,{default:function(){return v}});var n=a(6768),i=a(4232),s=a(5130);const d={class:"container py-5"},o={key:0,class:"text-center my-5"},r={key:1,class:"card shadow p-4 mx-auto",style:{"max-width":"600px"}},l={class:"mb-3"},c={class:"mb-3 mx-auto",style:{"max-width":"300px"}},m=["disabled"],p={key:0,class:"spinner-border spinner-border-sm me-2"},u={key:2,class:"text-center text-danger my-5"},y={key:3,class:"alert alert-warning mt-3"};function h(e,t,a,h,k,g){return(0,n.uX)(),(0,n.CE)("div",d,[k.loading?((0,n.uX)(),(0,n.CE)("div",o,[...t[2]||(t[2]=[(0,n.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,n.Lk)("span",{class:"visually-hidden"},"Loading candidate details...")],-1),(0,n.Lk)("p",{class:"mt-3"},"Loading candidate details...",-1)])])):k.candidate?((0,n.uX)(),(0,n.CE)("div",r,[t[12]||(t[12]=(0,n.Lk)("h4",{class:"mb-3 text-center"},"Candidate Application Checkout",-1)),(0,n.Lk)("div",l,[(0,n.Lk)("p",null,[t[3]||(t[3]=(0,n.Lk)("strong",null,"Full Name:",-1)),(0,n.eW)(" "+(0,i.v_)(k.candidate.first_name)+" "+(0,i.v_)(k.candidate.surname),1)]),(0,n.Lk)("p",null,[t[4]||(t[4]=(0,n.Lk)("strong",null,"Email:",-1)),(0,n.eW)(" "+(0,i.v_)(k.candidate.email||"N/A"),1)]),(0,n.Lk)("p",null,[t[5]||(t[5]=(0,n.Lk)("strong",null,"Phone:",-1)),(0,n.eW)(" "+(0,i.v_)(k.candidate.phone_country_code)+" "+(0,i.v_)(k.candidate.phone_number),1)]),(0,n.Lk)("p",null,[t[6]||(t[6]=(0,n.Lk)("strong",null,"Country:",-1)),(0,n.eW)(" "+(0,i.v_)(k.candidate.country?.name||"N/A"),1)]),(0,n.Lk)("p",null,[t[7]||(t[7]=(0,n.Lk)("strong",null,"State:",-1)),(0,n.eW)(" "+(0,i.v_)(k.candidate.state_of_origin?.name||"N/A"),1)]),(0,n.Lk)("p",null,[t[8]||(t[8]=(0,n.Lk)("strong",null,"Team:",-1)),(0,n.eW)(" "+(0,i.v_)(k.candidate.team_name||"N/A"),1)])]),t[13]||(t[13]=(0,n.Lk)("hr",null,null,-1)),t[14]||(t[14]=(0,n.Lk)("h5",{class:"mb-3 text-center text-success"},"Application Fee: ‚Ç¶10,000",-1)),(0,n.Lk)("div",c,[t[10]||(t[10]=(0,n.Lk)("label",{for:"paymentMethod",class:"form-label fw-bold"},"Payment Method",-1)),(0,n.bo)((0,n.Lk)("select",{id:"paymentMethod","onUpdate:modelValue":t[0]||(t[0]=e=>k.selectedPayment=e),class:"form-select"},[...t[9]||(t[9]=[(0,n.Lk)("option",{disabled:"",value:""},"Select Payment Option",-1),(0,n.Lk)("option",{value:"OPAY"},"Opay",-1),(0,n.Lk)("option",{value:"BANK"},"Bank Transfer",-1)])],512),[[s.u1,k.selectedPayment]])]),(0,n.Lk)("button",{class:"btn btn-primary w-100 mt-2",disabled:!k.selectedPayment||k.submitting,onClick:t[1]||(t[1]=(...e)=>g.proceedToPayment&&g.proceedToPayment(...e))},[k.submitting?((0,n.uX)(),(0,n.CE)("span",p)):(0,n.Q3)("",!0),t[11]||(t[11]=(0,n.eW)(" Proceed to Payment ",-1))],8,m),k.feedback.message?((0,n.uX)(),(0,n.CE)("div",{key:0,class:(0,i.C4)(["alert mt-3",k.feedback.type]),role:"alert"},(0,i.v_)(k.feedback.message),3)):(0,n.Q3)("",!0)])):((0,n.uX)(),(0,n.CE)("div",u,[...t[15]||(t[15]=[(0,n.Lk)("p",null," Candidate details could not be loaded.",-1)])])),k.paymentError?((0,n.uX)(),(0,n.CE)("div",y,(0,i.v_)(k.paymentError),1)):(0,n.Q3)("",!0)])}var k=a(4373),g={name:"CheckOut_Candidate",props:{candidateId:{type:String,required:!0}},data(){return{candidate:null,loading:!0,submitting:!1,selectedPayment:"",feedback:{message:"",type:""},paymentError:null}},methods:{async fetchCandidate(){this.loading=!0;try{const e=await k.A.get(`http://127.0.0.1:8000/api/candidates/${encodeURIComponent(this.candidateId)}/`);this.candidate=e.data,console.log("‚úÖ Candidate loaded:",this.candidate)}catch(e){console.error("‚ùå Error loading candidate:",e),this.feedback={message:"Failed to load candidate details.",type:"alert-danger"}}finally{this.loading=!1}},async proceedToPayment(){if(this.paymentError=null,this.feedback={message:"",type:""},!this.submitting)if(this.selectedPayment){this.submitting=!0,this.feedback={message:"",type:""},this.paymentError=null;try{this.loading=!0,this.candidate||await this.fetchCandidate();const e=await k.A.get(`http://127.0.0.1:8000/api/payments/candidate/check/${this.candidate.id}/`);if(e.data.exists)return this.paymentError="This candidate already has a payment record. You cannot pay twice.",this.loading=!1,void(this.submitting=!1);console.log("üì¶ Sending payload:",{candidate:this.candidate.id,amount:1e4,method:this.selectedPayment});const t=await k.A.post("http://127.0.0.1:8000/api/payments/candidate/mock-initiate/",{candidate:this.candidate.id,amount:1e4,method:this.selectedPayment});this.paymentResponse=t.data,console.log("‚úÖ Payment initiated:",this.paymentResponse);const a=this.paymentResponse?.data?.reference;if(!a)return console.error("‚ùå Missing reference in response:",this.paymentResponse),this.paymentError="Could not generate payment reference. Please retry.",this.loading=!1,void(this.submitting=!1);console.log("Redirecting with reference:",a),alert("‚úÖ Proceeding to payment gateway..."),window.location.href=this.paymentResponse.data.opay_mock_url}catch(e){if(console.error("üî• Payment error:",e.response?.data||e),e.message.includes("Network Error")){const e=confirm("‚ö†Ô∏è Network error detected.\nWould you like to retry payment?");if(e)return this.submitting=!1,void this.proceedToPayment()}this.paymentError=e.response?.data?.message||"Payment failed. Please check your internet and try again."}finally{this.loading=!1,this.submitting=!1}}else this.feedback={message:"Please select a payment method.",type:"alert-warning"}}},mounted(){console.log("Candidate ID from route:",this.candidateId),this.fetchCandidate()}},f=a(1241);const b=(0,f.A)(g,[["render",h],["__scopeId","data-v-85ed2c0c"]]);var v=b}}]);
//# sourceMappingURL=144.02a87189.js.map